<!DOCTYPE html>
<html lang="en" style="height:100%;" ng-app="modeling" ng-controller="simCtrl">
<head>
    <meta charset="utf-8">
    <title>System Modeling</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="keywords" content="System Modeling"/>
    <meta name="description" content="System Modeling"/>
    <!-- Core CSS -->
    <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="css/font-awesome.min.css" rel="stylesheet">
    <link href="http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,400,300,600,700"
          rel="stylesheet">
    <link href="http://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic" rel="stylesheet">
    <!-- Style Library -->
    <link href="css/style-library-1.css" rel="stylesheet">
    <link href="css/plugins.css" rel="stylesheet">
    <link href="css/blocks.css" rel="stylesheet">
    <link href="css/custom.css" rel="stylesheet">
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements. All other JS at the end of file. -->
    <!--[if lt IE 9]>
    <script src="js/html5shiv.js"></script>
    <script src="js/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.4.0/animate.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>
    <script>
        var app = angular.module('modeling', []);
        app.controller('simCtrl', function ($scope) {
            $scope.customers = 10;
            $scope.serviceT = '[ { "time": 1, "prob": 0.1, "cProb": 0.1 }, { "time": 2, "prob": 0.2, "cProb": 0.3 }, { "time": 3, "prob": 0.3, "cProb": 0.6 }, { "time": 4, "prob": 0.25, "cProb": 0.85 }, { "time": 5, "prob": 0.1, "cProb": 0.95 }, { "time": 6, "prob": 0.05, "cProb": 1 } ]';


            $scope.calc = function () {
                var customers = $scope.customers;
                var serviceTimes = JSON.parse($scope.serviceT);
                var iterations = [{
                    i: 0,
                    interArrival: 0,
                    arrival: 0,
                    serviceTime: 0,
                    serviceBegin: 0,
                    waitingTime: 0,
                    serviceEnd: 0,
                    timeInSystem: 0,
                    idleTime: 0
                }];

                function getServiceTime(i) {
                    var random = Math.random() * 100;
                    for (var i = 0; i < serviceTimes.length; i++) {
                        if (random <= serviceTimes[i].cProb * 100)
                            return serviceTimes[i];
                    }

                    return serviceTimes[0];
                }

                for (var i = 1; i <= customers; i++) {
                    var serviceTime = getServiceTime(i);
                    var iteration = JSON.parse(JSON.stringify(iterations.slice()[i - 1]));
                    iteration.i = i;
                    iteration.interArrival = iteration.arrival;
                    iteration.arrival += serviceTime.time;
                    iteration.interArrival = iteration.arrival - iteration.interArrival;
                    iteration.serviceTime = serviceTime.time;
                    iteration.serviceBegin = (iteration.arrival > iteration.serviceEnd) ? iteration.arrival : iteration.serviceEnd;
                    iteration.idleTime = iteration.arrival - iteration.serviceEnd;
                    iteration.idleTime = (iteration.idleTime > 0) ? iteration.idleTime : 0;
                    iteration.serviceEnd = iteration.serviceBegin + iteration.serviceTime;
                    iteration.waitingTime = iteration.serviceBegin - iteration.arrival;
                    iteration.timeInSystem = iteration.serviceEnd - iteration.arrival;
                    iterations.push(iteration);
                }
                var totalRun = iteration.serviceEnd;
                iteration = {
                    i: 'Totals',
                    interArrival: 0,
                    arrival: 0,
                    serviceTime: 0,
                    serviceBegin: 0,
                    waitingTime: 0,
                    serviceEnd: 0,
                    timeInSystem: 0,
                    idleTime: 0
                };
                var waitCustomers = 0;
                for (var i = 1; i < iterations.length; i++) {
                    iteration.interArrival += iterations[i].interArrival;
                    iteration.arrival += iterations[i].arrival;
                    iteration.serviceTime += iterations[i].serviceTime;
                    iteration.serviceBegin += iterations[i].serviceBegin;
                    iteration.waitingTime += iterations[i].waitingTime;
                    iteration.serviceEnd += iterations[i].serviceEnd;
                    iteration.timeInSystem += iterations[i].timeInSystem;
                    iteration.idleTime += iterations[i].idleTime;
                    if (iterations[i].waitingTime != 0)
                        waitCustomers++;
                }

                iterations.push({
                    i: "Summary",
                    interArrival: '-',
                    arrival: '-',
                    serviceTime: '-',
                    serviceBegin: '-',
                    waitingTime: '-',
                    serviceEnd: '-',
                    timeInSystem: '-',
                    idleTime: '-'
                });
                iterations.push(iteration);
                iterations.push({
                    i: 'Avgs',
                    interArrival: iteration.interArrival / customers,
                    arrival: iteration.arrival / customers,
                    serviceTime: iteration.serviceTime / customers,
                    serviceBegin: iteration.serviceBegin / customers,
                    waitingTime: iteration.waitingTime / customers,
                    serviceEnd: iteration.serviceEnd / customers,
                    timeInSystem: iteration.timeInSystem / customers,
                    idleTime: iteration.idleTime / customers
                });

                $scope.iterations = iterations.splice(1);
                var summary = {
                    avg: iteration.waitingTime / customers,
                    wait: waitCustomers / customers,
                    idle: iteration.idleTime / totalRun,
                    serv: iteration.serviceTime / customers
                };
                $scope.summary = summary;
            }
            $scope.calc();
        });
    </script>
</head>
<body data-spy="scroll" data-target="nav">
<header id="header-3" class="soft-scroll header-3">
    <section class="hero">
        <div class="container table-responsive">
            <div class="brand">
                <a href="#" class="black white-hover text-capitalize lead">Modeling</a>
            </div>
            <div class="navicon">
            </div>
            <form role="form">
                <div class="col-md-8 col-md-offset-2 text-center">
                    <div class="editContent">
                        <h3>Enter Your Simulation Options<br></h3>
                    </div>
                    <div class="editContent">
                        <div class="form-group">
                            <input type="number" class="form-control" value="10" placeholder="Number of Customers"
                                   name="customers" ng-model="customers">
                        </div>
                        <div class="form-group">
                            <label class="control-label">Service Times</label>
                            <textarea class="form-control" rows="3" name="serviceT" ng-model="serviceT">
</textarea>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-md-offset-3 text-center">
                    <button class="btn btn-danger btn-block" ng-click="calc()">Compute</button>
                </div>
            </form>
            <table class="table  table-hover">
                <thead>
                <tr>
                    <th>#</th>
                    <th>Interarrival<br></th>
                    <th>arrival</th>
                    <th>serviceTime</th>
                    <th>service Begin</th>
                    <th>waiting Time</th>
                    <th>service End</th>
                    <th>time In System</th>
                    <th>idle Time</th>
                </tr>
                </thead>
                <tbody>
                <tr ng-repeat="iteration in iterations">
                    <td>{{iteration.i}}</td>
                    <td>{{iteration.interArrival}}</td>
                    <td>{{iteration.arrival}}</td>
                    <td>{{iteration.serviceTime}}</td>
                    <td>{{iteration.serviceBegin}}</td>
                    <td>{{iteration.waitingTime}}</td>
                    <td>{{iteration.serviceEnd}}</td>
                    <td>{{iteration.timeInSystem}}</td>
                    <td>{{iteration.idleTime}}</td>
                </tr>
                </tbody>
            </table>

            <table class="table table-striped ">
                <tbody>
                <tr>
                    <td>𝐴𝑣𝑒𝑟𝑎𝑔𝑒 𝑊𝑎𝑖𝑡𝑖𝑛𝑔 𝑇𝑖𝑚𝑒</td>
                    <td>{{summary.avg}}</td>
                </tr>
                <tr>
                    <td>𝑃𝑟𝑜𝑏𝑎𝑏𝑖𝑙𝑖𝑡𝑦 (𝑤𝑎𝑖𝑡)</td>
                    <td>{{summary.wait}}</td>
                </tr>
                <tr>
                    <td>𝑃𝑟𝑜𝑏𝑎𝑏𝑖𝑙𝑖𝑡𝑦 𝑖𝑑𝑙𝑒 𝑠𝑒𝑟𝑣𝑒𝑟</td>
                    <td>{{summary.idle}}</td>
                </tr>
                <tr>
                    <td>𝐴𝑣𝑒𝑟𝑎𝑔𝑒 𝑠𝑒𝑟𝑣𝑖𝑐𝑒 𝑡𝑖𝑚𝑒</td>
                    <td>{{summary.serv}}</td>
                </tr>

                </tbody>
            </table>
        </div>
    </section>
</header>
<script type="text/javascript" src="js/jquery-1.11.1.min.js"></script>
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/plugins.js"></script>
<script src="https://maps.google.com/maps/api/js?sensor=true"></script>
<script type="text/javascript" src="js/bskit-scripts.js"></script>
<script type="text/javascript" src="https://cdn.rawgit.com/MhdAljuboori/6ea3a3fa48248e3a132a/raw/animator.js"></script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/waypoints/4.0.0/jquery.waypoints.min.js"></script>
</body>
</html>
